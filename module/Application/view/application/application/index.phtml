<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<style type="text/css">
body{ 
    background: #f5faff;
	margin:0;padding:0;
}
#l-map{height:100%;width:78%;float:left;border-right:2px solid #bcbcbc;}
#r-result{height:100%;width:20%;float:left;}
.demo_con{
width: 960px;
margin:40px auto 0;
}
.button{
width: 140px;
line-height: 38px;
text-align: center;
font-weight: bold;
color: #fff;
text-shadow:1px 1px 1px #333;
border-radius: 5px;
margin:0 20px 20px 0;
position: relative;
overflow: hidden;
}
.button.blue{
border:1px solid #1e7db9;
box-shadow: 0 1px 2px #8fcaee inset,0 -1px 0 #497897 inset,0 -2px 3px #8fcaee inset;
background: -webkit-linear-gradient(top,#42a4e0,#2e88c0);
background: -moz-linear-gradient(top,#42a4e0,#2e88c0);
background: linear-gradient(top,#42a4e0,#2e88c0);
}
</style>
<!--引用百度地图API-->
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.5&ak=EZfQrPMLSMR4YvDnDMwO9r81"></script>



    <div class="hero-unit" style="text-align:center;">
         <h1><?php echo sprintf($this->translate('Welcome to %sSensorCloud%s'), '<span class="zf-green">', '</span>') ?></h1> 
    </div>
  <table width="100%" height="550px" border="0" align = "center" >
  <tr>
    <td width="80%" align="center"><div style="height:550px;border:#ccc solid 1px;width:90%" id="allmap" ></div></td>
    <td width="20%" align="center"><table width="90%" height="550" border="0" align ="center">
      <tr>
        <td><button type="button" class="button blue" onclick="window.location.href = '<?php echo $this->url('subscriber',
                array('action'=>'subscriberindex'));?>'"><?php echo $this->translate('服务订阅') ?></button></td>
      </tr>
      <tr>
        <td> <button type="button" class="button blue" onclick="window.location.href = '<?php echo $this->url('poster',
                array('action'=>'posterindex'));?>'"><?php echo $this->translate('服务发布') ?></button></td>
      </tr>
    </table></td>
  </tr>
</table>

<script type="text/javascript">
var map = new BMap.Map("allmap");            
var centerPoint = new BMap.Point(110.404, 37.915);
var testPoint = new BMap.Point(116.404,39.915);
map.centerAndZoom(centerPoint,5);                     
map.enableScrollWheelZoom();  

var centerMarker = new BMap.Marker(centerPoint);
var testMarker = new BMap.Marker(testPoint);
//map.addOverlay(centerMarker);
//map.addOverlay(testMarker);

var tilelayer=new BMap.TileLayer();
tilelayer.getTilesUrl=function(){
 return "layer.gif";
};
map.addTileLayer(tilelayer);

</script>

<?php  $sinks = $this->sinks;
foreach ($sinks as $sink) :?>
<?php
echo "<script> 
var name = \"$sink->name\";
var longitude = \"$sink->longitude\";
var altitude = \"$sink->latitude\";
var point = new BMap.Point(longitude, altitude);
var marker = new BMap.Marker(point); 
marker.addEventListener(\"mouseover\",function(){
		var label = new BMap.Label(name,{offset:new BMap.Size(20,-10)});
		marker.setLabel(label);
	});
	marker.addEventListener(\"click\",function(e){
		showSinkInfo(\"$sink->id\");
	});
map.addOverlay(marker);
 </script>";
?>
	
<?php endforeach;?>
<script type="text/javascript">
function showSinkInfo(sink_id){
	var url = "/SensorCloud/public/subscriber/sinkinfo/";
	url += sink_id;
	window.location.href=url;
}
</script>

